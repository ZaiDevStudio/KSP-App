<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - KSP App</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="mobile-container" style="justify-content: center; display: flex; flex-direction: column; padding: 30px;">
        <div class="text-center">
            <img src="KSP.png" alt="Logo" class="logo-login">
            <h2 style="color: var(--primary-green);">KOPERASI SIMPAN PINJAM</h2>
            <p>(KSP)</p>
        </div>
        
        <div class="form-group">
            <label>Email / Username</label>
            <input type="email" id="email" placeholder="Masukan email">
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="password" id="password" placeholder="Masukan password">
        </div>
        
        <div class="form-group">
            <button class="btn-gold" id="btnLogin">MASUK</button>
        </div>
        
        <div class="text-center">
            <p style="font-size: 12px; cursor: pointer; color: blue;" onclick="lupaSandi()">Lupa Password / Ubah Sandi?</p>
            <p style="font-size: 12px;">Belum punya akun? <span style="color: var(--gold); font-weight: bold; cursor: pointer;" onclick="toggleDaftar()">Daftar</span></p>
        </div>

        <div id="formDaftar" style="display: none; margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 20px;">
            <h3 class="text-center">Daftar Baru</h3>
            <div class="form-group"><input type="text" id="regName" placeholder="Nama Lengkap"></div>
            <div class="form-group"><input type="email" id="regEmail" placeholder="Email"></div>
            <div class="form-group"><input type="password" id="regPass" placeholder="Password"></div>
            <div class="form-group"><button class="btn-gold" id="btnRegister">DAFTAR SEKARANG</button></div>
        </div>
    </div>

    <script type="module">
        import { auth, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile } from './config.js';

        // Login
        document.getElementById('btnLogin').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                window.location.href = 'index.html';
            } catch (error) {
                Swal.fire('Error', error.message, 'error');
            }
        });

        // Toggle Daftar
        window.toggleDaftar = () => {
            const f = document.getElementById('formDaftar');
            f.style.display = f.style.display === 'none' ? 'block' : 'none';
        }

        // Register
        document.getElementById('btnRegister').addEventListener('click', async () => {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            try {
                const userCred = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(userCred.user, { displayName: name });
                Swal.fire('Sukses', 'Akun berhasil dibuat!', 'success');
            } catch (error) {
                Swal.fire('Gagal', error.message, 'error');
            }
        });

        window.lupaSandi = () => {
            Swal.fire('Info', 'Fitur reset via OTP SMS memerlukan biaya server. Silakan gunakan Reset Email (gratis) untuk demo ini.', 'info');
        }
    </script>
</body>
</html>
